#![no_std]
#![no_main]

use hal::{clock::ClockControl, gpio::IO, peripherals::Peripherals, prelude::*, Delay};
use esp_backtrace as _;
use esp_println::println;

#[entry]
fn main() -> ! {
    let peripherals = Peripherals::take();
    let system = peripherals.SYSTEM.split();
    let clocks = ClockControl::boot_defaults(system.clock_control).freeze();
    let io = IO::new(peripherals.GPIO, peripherals.IO_MUX);
    let mut led = io.pins.gpio4.into_push_pull_output();
    let mut delay = Delay::new(&clocks);
    led.set_high().unwrap();

    let sheet: [(u32,  u32, u32); 531] = [
        (3817, 375000, 125000), (2551, 125000, 125000), (3215, 375000, 125000), (1912, 375000, 125000), (2551, 2125000, 125000), (3817, 375000, 125000), (2551, 125000, 125000), (3215, 375000, 125000), (1912, 375000, 125000), (2551, 2125000, 125000), (3817, 375000, 125000), (2551, 125000, 125000), (3215, 375000, 125000), (1912, 375000, 125000), (2551, 2125000, 125000), (3401, 625000, 125000), (1704, 375000, 125000), (1608, 375000, 125000), (1912, 125000, 125000), (1704, 125000, 125000), (2146, 125000, 125000), (1912, 125000, 125000), (2551, 125000, 125000), (2024, 125000, 125000), (3215, 0, 250000), (3401, 0, 250000), (3215, 0, 250000), (3817, 125000, 125000), (5102, 0, 250000), (6410, 250000, 250000), (6410, 0, 250000), (5102, 0, 250000), (3817, 62500, 187500), (4049, 62500, 187500), (5102, 0, 250000), (4049, 0, 250000), (3401, 312500, 187500), (4049, 125000, 125000), (3401, 125000, 125000), (2551, 125000, 125000), (3401, 187500, 62500), (3817, 125000, 125000), (3215, 62500, 187500), (2551, 375000, 125000), (3215, 0, 250000), (2551, 0, 250000), (1912, 0, 62500), (2551, 0, 62500), (3215, 0, 62500), (5102, 0, 62500), (5714, 0, 250000), (5102, 62500, 187500), (4292, 62500, 187500), (3817, 62500, 187500), (3401, 62500, 125000), (3401, 0, 62500), (3215, 62500, 62500), (3215, 62500, 62500), (2551, 62500, 62500), (2551, 62500, 62500), (2024, 62500, 62500), (2024, 62500, 62500), (1912, 62500, 62500), (1912, 62500, 62500), (3817, 250000, 250000), (2551, 0, 250000), (3215, 250000, 250000), (3817, 250000, 250000), (1912, 250000, 250000), (3817, 250000, 250000), (3215, 250000, 250000), (3817, 0, 250000), (3401, 0, 250000), (3215, 0, 250000), (2551, 250000, 250000), (1912, 0, 250000), (1704, 250000, 250000), (2551, 250000, 250000), (2024, 250000, 250000), (2551, 250000, 250000), (3215, 250000, 250000), (2551, 0, 250000), (2865, 0, 250000), (3215, 0, 250000), (3817, 250000, 250000), (2551, 0, 250000), (3215, 250000, 250000), (3817, 250000, 250000), (3401, 250000, 250000), (3817, 250000, 250000), (3215, 250000, 250000), (3817, 0, 250000), (3401, 0, 250000), (3215, 0, 250000), (2551, 250000, 250000), (3215, 0, 250000), (2551, 250000, 250000), (3215, 250000, 250000), (2551, 250000, 250000), (3215, 250000, 250000), (2146, 0, 125000), (2551, 0, 125000), (2865, 0, 125000), (3215, 0, 125000), (3401, 0, 250000), (3215, 0, 250000), (3401, 0, 250000), (3817, 250000, 250000), (2551, 0, 250000), (3215, 250000, 250000), (3817, 250000, 250000), (1912, 250000, 250000), (3817, 250000, 250000), (3215, 250000, 250000), (3817, 0, 250000), (3401, 0, 250000), (3215, 0, 250000), (2551, 250000, 250000), (1912, 0, 250000), (1704, 250000, 250000), (2551, 250000, 250000), (2024, 250000, 250000), (2551, 250000, 250000), (3215, 250000, 250000), (2551, 0, 250000), (2865, 0, 250000), (3215, 0, 250000), (3817, 250000, 250000), (2551, 0, 250000), (3215, 250000, 250000), (3817, 250000, 250000), (3401, 250000, 250000), (3817, 250000, 250000), (3215, 250000, 250000), (3817, 0, 250000), (3401, 0, 250000), (3215, 0, 250000), (2551, 250000, 250000), (3215, 0, 250000), (2146, 250000, 250000), (3817, 250000, 250000), (2551, 250000, 250000), (3215, 250000, 250000), (2146, 0, 250000), (2865, 0, 250000), (3401, 62500, 187500), (3215, 0, 250000), (3401, 0, 250000), (3817, 250000, 250000), (2551, 0, 250000), (3215, 250000, 250000), (3817, 250000, 250000), (3215, 250000, 250000), (3817, 0, 250000), (3215, 0, 250000), (2551, 0, 250000), (1704, 0, 250000), (1912, 0, 250000), (2551, 0, 250000), (3215, 0, 250000), (2551, 250000, 250000), (1912, 0, 250000), (1704, 250000, 250000), (2551, 250000, 250000), (1704, 250000, 250000), (1912, 0, 250000), (1704, 0, 250000), (1608, 0, 250000), (1276, 0, 250000), (1608, 0, 250000), (1704, 0, 250000), (2551, 0, 250000), (3817, 250000, 250000), (2551, 0, 250000), (3215, 250000, 250000), (3817, 250000, 250000), (3215, 250000, 250000), (3817, 0, 250000), (3215, 0, 250000), (2551, 0, 250000), (1704, 0, 250000), (1912, 0, 250000), (2551, 0, 250000), (3215, 0, 250000), (2551, 250000, 250000), (3215, 0, 250000), (2551, 250000, 250000), (2551, 250000, 250000), (3215, 0, 250000), (2551, 0, 250000), (1912, 0, 250000), (2551, 0, 250000), (1912, 0, 250000), (1608, 0, 250000), (1912, 0, 250000), (2551, 0, 250000), (3401, 0, 250000), (3817, 250000, 250000), (2551, 0, 250000), (3215, 250000, 250000), (3817, 250000, 250000), (3215, 250000, 250000), (3817, 0, 250000), (3215, 0, 250000), (2551, 0, 250000), (1704, 0, 250000), (1912, 0, 250000), (2551, 0, 250000), (3215, 0, 250000), (2551, 250000, 250000), (1912, 0, 250000), (1704, 250000, 250000), (2551, 250000, 250000), (1704, 250000, 250000), (1912, 0, 250000), (1704, 0, 250000), (1608, 0, 250000), (1276, 0, 250000), (1608, 0, 250000), (1704, 0, 250000), (2551, 0, 250000), (3817, 250000, 250000), (2551, 0, 250000), (3215, 250000, 250000), (3817, 250000, 250000), (3215, 250000, 250000), (3817, 0, 250000), (3215, 0, 250000), (2551, 0, 250000), (1704, 0, 250000), (1912, 0, 250000), (2551, 0, 250000), (3215, 0, 250000), (2551, 250000, 250000), (3215, 0, 250000), (2551, 250000, 250000), (2551, 250000, 250000), (3215, 0, 250000), (5102, 0, 250000), (4292, 0, 250000), (3817, 0, 250000), (3401, 0, 250000), (3215, 0, 250000), (2551, 0, 250000), (2024, 0, 250000), (1912, 55250000, 250000), (2551, 125000, 125000), (3215, 125000, 125000), (2551, 125000, 125000), (1912, 375000, 125000), (1912, 1375000, 125000), (1912, 375000, 125000), (1912, 1375000, 125000), (1912, 375000, 125000), (1912, 1375000, 125000), (1912, 375000, 125000), (1912, 375000, 125000), (1912, 125000, 125000), (2551, 125000, 125000), (3215, 125000, 125000), (2551, 125000, 125000), (1912, 375000, 125000), (1912, 375000, 125000), (1912, 375000, 125000), (1912, 375000, 125000), (1912, 375000, 125000), (1912, 375000, 125000), (1912, 375000, 125000), (1912, 375000, 125000), (1912, 125000, 125000), (1912, 125000, 125000), (1912, 125000, 125000), (1912, 0, 125000), (1912, 0, 125000), (1912, 125000, 125000), (1912, 125000, 125000), (1912, 125000, 125000), (1912, 0, 125000), (1912, 0, 125000), (1912, 125000, 125000), (1912, 125000, 125000), (1912, 125000, 125000), (1912, 0, 125000), (1912, 0, 125000), (1912, 0, 125000), (1912, 0, 125000), (2551, 125000, 125000), (3401, 0, 125000), (3401, 0, 125000), (2551, 0, 125000), (2551, 0, 125000), (1912, 0, 125000), (1912, 0, 125000), (1912, 0, 125000), (1912, 0, 125000), (1912, 0, 125000), (1912, 0, 125000), (1912, 0, 125000), (1912, 0, 125000), (1912, 0, 125000), (1912, 0, 125000), (1912, 0, 125000), (1912, 0, 125000), (1912, 0, 125000), (1912, 0, 125000), (1912, 0, 125000), (1912, 0, 125000), (1912, 0, 125000), (1912, 0, 125000), (1912, 0, 125000), (1912, 0, 125000), (1912, 0, 125000), (1912, 0, 125000), (1912, 0, 125000), (1912, 0, 125000), (1912, 250000, 250000), (1912, 250000, 250000), (1912, 0, 125000), (1912, 0, 125000), (1912, 0, 125000), (1912, 0, 125000), (1912, 0, 125000), (1912, 0, 125000), (1912, 0, 125000), (1912, 0, 125000), (1912, 0, 125000), (1912, 0, 125000), (1912, 0, 125000), (1912, 0, 125000), (1912, 0, 125000), (1912, 0, 125000), (1912, 0, 125000), (1912, 0, 125000), (1912, 0, 125000), (1912, 0, 125000), (1912, 0, 125000), (1912, 0, 125000), (1912, 0, 125000), (1912, 0, 125000), (1912, 0, 125000), (1912, 0, 125000), (1912, 250000, 250000), (1912, 250000, 250000), (1912, 0, 125000), (1912, 0, 125000), (1912, 0, 125000), (1912, 0, 125000), (1912, 0, 125000), (1912, 0, 125000), (1912, 0, 125000), (1912, 0, 125000), (1912, 0, 125000), (1912, 0, 125000), (1912, 0, 125000), (1912, 0, 125000), (1912, 0, 125000), (1912, 0, 125000), (1912, 0, 125000), (1912, 0, 125000), (1912, 0, 125000), (1912, 0, 125000), (1912, 0, 125000), (1912, 0, 125000), (1912, 0, 125000), (1912, 0, 125000), (1912, 0, 125000), (1912, 0, 125000), (1912, 250000, 250000), (1912, 250000, 250000), (1912, 0, 250000), (2551, 0, 250000), (3215, 0, 250000), (2551, 0, 250000), (2865, 0, 250000), (3215, 0, 250000), (3817, 0, 250000), (2551, 250000, 250000), (3215, 250000, 250000), (2146, 0, 125000), (2551, 0, 125000), (2865, 0, 125000), (3215, 0, 125000), (3401, 0, 250000), (3215, 0, 250000), (3401, 0, 250000), (3817, 250000, 250000), (2551, 0, 250000), (3215, 250000, 250000), (3817, 250000, 250000), (3215, 250000, 250000), (3817, 0, 250000), (3215, 0, 250000), (2551, 0, 250000), (1704, 0, 250000), (1912, 0, 250000), (2551, 0, 250000), (3215, 0, 250000), (2551, 250000, 250000), (1912, 0, 250000), (1704, 250000, 250000), (2551, 250000, 250000), (1704, 250000, 250000), (1912, 0, 250000), (1704, 0, 250000), (1608, 0, 250000), (1276, 0, 250000), (1608, 0, 250000), (1704, 0, 250000), (2551, 0, 250000), (3817, 250000, 250000), (2551, 0, 250000), (3215, 250000, 250000), (3817, 250000, 250000), (3215, 250000, 250000), (3817, 0, 250000), (3215, 0, 250000), (2551, 0, 250000), (1704, 0, 250000), (1912, 0, 250000), (2551, 0, 250000), (3215, 0, 250000), (2551, 250000, 250000), (3215, 0, 250000), (2551, 250000, 250000), (2551, 250000, 250000), (3215, 0, 250000), (2551, 0, 250000), (1912, 0, 250000), (2551, 0, 250000), (1912, 0, 250000), (1608, 0, 250000), (1912, 0, 250000), (2551, 0, 250000), (3401, 0, 250000), (3817, 250000, 250000), (2551, 0, 250000), (3215, 250000, 250000), (3817, 250000, 250000), (3215, 250000, 250000), (3817, 0, 250000), (3215, 0, 250000), (2551, 0, 250000), (1704, 0, 250000), (1912, 0, 250000), (2551, 0, 250000), (3215, 0, 250000), (2551, 250000, 250000), (1912, 0, 250000), (1704, 250000, 250000), (2551, 250000, 250000), (1704, 250000, 250000), (1912, 0, 250000), (1704, 0, 250000), (1608, 0, 250000), (1276, 0, 250000), (1608, 0, 250000), (1704, 0, 250000), (2551, 0, 250000), (3817, 250000, 250000), (2551, 0, 250000), (3215, 250000, 250000), (3817, 250000, 250000), (3215, 250000, 250000), (3817, 0, 250000), (3215, 0, 250000), (2551, 0, 250000), (1704, 0, 250000), (1912, 0, 250000), (2551, 0, 250000), (3215, 0, 250000), (2551, 250000, 250000), (3215, 0, 250000), (2551, 250000, 250000), (2551, 250000, 250000), (3215, 0, 250000), (2551, 0, 250000), (1912, 0, 250000), (2551, 0, 250000), (1912, 0, 250000), (1608, 0, 250000), (1912, 0, 250000), (2551, 0, 250000), (3401, 0, 250000), (3817, 250000, 250000), (2551, 0, 250000), (3215, 250000, 250000), (3817, 250000, 250000), (3215, 250000, 250000), (3817, 0, 250000), (3215, 0, 250000), (2551, 0, 250000), (1704, 0, 250000), (1912, 0, 250000), (2551, 0, 250000), (3215, 0, 250000), (2551, 250000, 250000), (1912, 0, 250000), (1704, 250000, 250000), (2551, 250000, 250000), (1704, 250000, 250000), (1912, 0, 250000), (1704, 0, 250000), (1608, 0, 250000), (1276, 0, 250000), (1608, 0, 250000), (1704, 0, 250000), (2551, 0, 250000), (3817, 250000, 250000), (2551, 0, 250000), (3215, 250000, 250000), (3817, 250000, 250000), (3215, 250000, 250000), (3817, 0, 250000), (3215, 0, 250000), (2551, 0, 250000), (1704, 0, 250000), (1912, 0, 250000), (2551, 0, 250000), (3215, 0, 250000), (2551, 250000, 250000), (3215, 0, 250000), (2551, 250000, 250000), (2551, 250000, 250000), (3215, 0, 250000), (5102, 0, 250000), (4292, 0, 250000), (3817, 0, 250000), (3401, 0, 250000), (3215, 0, 250000), (2551, 0, 250000), (2024, 0, 250000)
    ];

    loop {
        for (frequency, pause_time, duration) in &sheet {
            println!("Playing {frequency} for {duration} us");
            for _ in 0..*duration/frequency {
                led.toggle().unwrap();
                delay.delay_us(*frequency);
            }
            if *pause_time > 0 {
                delay.delay_us(*pause_time);
            } else {
                delay.delay_us(*frequency/10);
            }
        }
    }
}